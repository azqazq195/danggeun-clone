# 부하 테스트

## nGrinder 사용

## Issue

### 진행한 테스트 횟수와 실제 생성된 데이터의 불일치

Post 를 생성하는 테스트를 진행하였다.\
nGrinder에서 제시한 성공한 테스트 수와 실제 DB에 저장된 데이터가 맞지 않는 현상을 보였다.

1. 1분간 테스트 진행
    - 성공한 테스트 41,624
    - 실제 DB에 저장된 데이터 갯수 43,429

|          |          |
|----------|----------|
| 총 Vuser  | 20       |
| TPS      | 740.2    |
| 최고 TPS   | 828.5    |
| 평균 테스트시간 | 27.07 MS |
| 총 실행 테스트 | 41,624   |
| 성공한 테스트  | 41,624   |
| 에러       | 0        |
| 동작 시간    | 00:01:01 |

```shell
mysql> select count(*) from post;
+----------+
| count(*) |
+----------+
|    43429 |
+----------+
1 row in set (0.00 sec)
```

2. 20 Vuser가 각 1,000번 테스트 진행 (총 20,000번)
    - 성공한 테스트 20,000
    - 실제 DB에 저장된 데이터 갯수 20,000

|          |          |
|----------|----------|
| 총 Vuser  | 20       |
| TPS      | 710.9    |
| 최고 TPS   | 935.9    |
| 평균 테스트시간 | 27.92 MS |
| 총 실행 테스트 | 20,000   |
| 성공한 테스트  | 20,000   |
| 에러       | 0        |
| 동작 시간    | 00:00:31 |

```shell
mysql> select count(*) from post;
+----------+
| count(*) |
+----------+
|    20000 |
+----------+
1 row in set (0.00 sec)
```

- 단순 entity 생성으로 동시성 문제가 발생할 수 있는 케이스인지 모르겠다.
- 만약 발생할 수 있다면, 20,000번 요청이라고 명시 했더라도 발생했어야 한다.
- nGrinder의 테스트 카운트 방식에 뭔가 문제가 있지 않을까 싶다.
